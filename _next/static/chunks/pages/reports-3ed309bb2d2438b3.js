(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{9828:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports",function(){return s(9871)}])},9871:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(5893),l=s(7294),n=s(1050),r=s(2668),o=s(6444),i=s(4898),c=s(1163),d=s(1491),m=s(6981);function h(){let[e,t]=(0,l.useState)(void 0),s=(0,c.useRouter)(),[h,x]=(0,l.useState)([]),[u,v]=(0,l.useState)(!0),[p,w]=(0,l.useState)("3m"),[j,g]=(0,l.useState)([]);return((0,l.useEffect)(()=>{(async function(){try{let{data:{session:e}}=await i.OQ.auth.getSession();t((null==e?void 0:e.user)||null)}catch(e){console.error("Error getting session:",e),t(null)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,s)=>{t((null==s?void 0:s.user)||null)});return()=>{e.unsubscribe()}},[]),(0,l.useEffect)(()=>{if(null===e){s.push("/auth");return}void 0!==e&&async function(){v(!0);try{let t="",s=new Date;switch(p){case"1m":let a=new Date(s);a.setMonth(s.getMonth()-1),t=a.toISOString().split("T")[0];break;case"3m":let l=new Date(s);l.setMonth(s.getMonth()-3),t=l.toISOString().split("T")[0];break;case"6m":let n=new Date(s);n.setMonth(s.getMonth()-6),t=n.toISOString().split("T")[0];break;case"1y":let r=new Date(s);r.setFullYear(s.getFullYear()-1),t=r.toISOString().split("T")[0]}let{data:o,error:c}=await i.OQ.from("glucose_records").select("*").eq("user_id",e.id).gte("date",t).order("date",{ascending:!0});if(c)throw c;x(o||[]);let h=(0,d.cS)(o||[]),u=Object.entries(h).map(e=>{let[t,s]=e;return{month:t,average:(0,m.j3)(s)}});g(u)}catch(e){console.error("Error fetching records:",e)}finally{v(!1)}}()},[e,s,p]),null==e)?(0,a.jsx)(n.Z,{title:"Loading...",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-primary-500 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"text-neutral-500",children:"Loading..."})]})})}):(0,a.jsx)(n.Z,{title:"Reports",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-neutral-800 mb-2",children:"Glucose Reports & Analytics"}),(0,a.jsx)("p",{className:"text-neutral-500",children:"Analyze your glucose trends and patterns over time"})]}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-neutral-100 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[(0,a.jsxs)("div",{className:"mb-4 md:mb-0",children:[(0,a.jsxs)("h2",{className:"text-lg font-medium text-neutral-800 flex items-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Report Settings"]}),(0,a.jsx)("p",{className:"text-sm text-neutral-500 mt-1",children:"Customize your report view and export data"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 w-full md:w-auto",children:[(0,a.jsxs)("div",{className:"w-full sm:w-auto",children:[(0,a.jsx)("label",{htmlFor:"dateRange",className:"form-label",children:"Date Range"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,a.jsxs)("select",{id:"dateRange",value:p,onChange:e=>w(e.target.value),className:"input-field pl-10 appearance-none pr-8",children:[(0,a.jsx)("option",{value:"1m",children:"Last Month"}),(0,a.jsx)("option",{value:"3m",children:"Last 3 Months"}),(0,a.jsx)("option",{value:"6m",children:"Last 6 Months"}),(0,a.jsx)("option",{value:"1y",children:"Last Year"})]}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,a.jsx)("svg",{className:"h-4 w-4 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,a.jsx)("div",{className:"flex items-end w-full sm:w-auto",children:(0,a.jsxs)("button",{onClick:()=>{if(0===h.length)return;let e=["Date,Time of Day,Glucose Level (mg/dL),Food Description"];h.forEach(t=>{let s=[t.date,t.time_of_day,t.glucose_level,'"'.concat(t.food_description.replace(/"/g,'""'),'"')];e.push(s.join(","))});let t=new Blob([e.join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download","diabetes-data-".concat(new Date().toISOString().split("T")[0],".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},disabled:0===h.length||u,className:"btn-secondary w-full sm:w-auto flex items-center justify-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export CSV"]})})]})]})}),u?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-primary-500 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("p",{className:"text-neutral-500",children:"Loading reports..."})]})}):h.length>0?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(o.Z,{records:h}),(0,a.jsx)("div",{className:"card hover:shadow-lg transition-all duration-300",children:(0,a.jsx)(r.Z,{records:h,title:"Glucose Levels - ".concat("1m"===p?"Last Month":"3m"===p?"Last 3 Months":"6m"===p?"Last 6 Months":"Last Year")})}),(0,a.jsxs)("div",{className:"card hover:shadow-lg transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-neutral-800",children:"Monthly Averages"})]}),j.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"table-minimal",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Month"}),(0,a.jsx)("th",{children:"Average Glucose Level"}),(0,a.jsx)("th",{children:"Trend"})]})}),(0,a.jsx)("tbody",{children:j.map((e,t)=>{let s=t>0?j[t-1].average:null,l=null!==s?e.average>s?"up":e.average<s?"down":"same":"same";return(0,a.jsxs)("tr",{className:"hover:bg-neutral-50",children:[(0,a.jsx)("td",{className:"font-medium",children:e.month}),(0,a.jsx)("td",{children:(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:[e.average," mg/dL"]})}),(0,a.jsxs)("td",{children:["up"===l&&(0,a.jsxs)("span",{className:"text-red-600 flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),(0,a.jsx)("span",{className:"font-medium",children:"Increased"})]}),"down"===l&&(0,a.jsxs)("span",{className:"text-green-600 flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),(0,a.jsx)("span",{className:"font-medium",children:"Decreased"})]}),"same"===l&&(0,a.jsxs)("span",{className:"text-neutral-500 flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1z",clipRule:"evenodd"})}),(0,a.jsx)("span",{className:"font-medium",children:"No Change"})]})]})]},e.month)})})]})}):(0,a.jsxs)("div",{className:"text-center py-8 px-4 bg-neutral-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-neutral-500",children:"Not enough data to show monthly averages"}),(0,a.jsx)("p",{className:"text-neutral-400 text-sm mt-1",children:"Add more readings across different months to see trends"})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12 px-4 bg-neutral-50 rounded-xl",children:[(0,a.jsx)("svg",{className:"w-16 h-16 text-neutral-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-neutral-800 mb-2",children:"No Records Found"}),(0,a.jsx)("p",{className:"text-neutral-500 mb-6 max-w-md mx-auto",children:"No glucose records found for the selected time period. Try selecting a different date range or add new readings."}),(0,a.jsxs)("button",{onClick:()=>s.push("/records/add"),className:"btn-primary inline-flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Your First Reading"]})]})]})})}}},function(e){e.O(0,[196,208,309,52,50,214,888,774,179],function(){return e(e.s=9828)}),_N_E=e.O()}]);