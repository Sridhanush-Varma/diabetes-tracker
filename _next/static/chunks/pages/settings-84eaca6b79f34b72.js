(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2837:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return a(6844)}])},6844:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(5893),s=a(7294),l=a(1050),n=a(1163),i=a(4898);function o(){let[e,t]=(0,s.useState)(void 0),a=(0,n.useRouter)(),[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async function(){try{let{data:{session:e}}=await i.OQ.auth.getSession();t((null==e?void 0:e.user)||null)}catch(e){console.error("Error getting session:",e),t(null)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,a)=>{t((null==a?void 0:a.user)||null)});return()=>{e.unsubscribe()}},[]),(0,s.useEffect)(()=>{if(null===e){a.push("/auth");return}void 0!==e&&async function(){try{let{data:t,error:a}=await i.OQ.from("profiles").select("name").eq("id",e.id).single();if(a&&"PGRST116"!==a.code){console.error("Error fetching user profile:",a);return}t&&c(t.name||"")}catch(e){console.error("Error fetching user profile:",e)}}()},[e,a]);let p=async t=>{if(t.preventDefault(),e){u(!0),h(null);try{let{error:t}=await i.OQ.from("profiles").upsert({id:e.id,name:o,updated_at:new Date().toISOString()});if(t)throw t;h({text:"Profile updated successfully!",type:"success"})}catch(e){h({text:e.message||"An error occurred while updating your profile",type:"error"})}finally{u(!1)}}},b=async()=>{if(e){f(!0);try{let{data:t,error:a}=await i.OQ.from("glucose_records").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(a)throw a;if(0===t.length){h({text:"No data to export",type:"error"});return}let r=["Date,Time of Day,Glucose Level (mg/dL),Food Description,Created At"];t.forEach(e=>{let t=[e.date,e.time_of_day,e.glucose_level,'"'.concat(e.food_description.replace(/"/g,'""'),'"'),e.created_at];r.push(t.join(","))});let s=r.join("\n"),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(l),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","diabetes-data-full-export-".concat(new Date().toISOString().split("T")[0],".csv")),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),h({text:"Data exported successfully!",type:"success"})}catch(e){h({text:e.message||"An error occurred while exporting your data",type:"error"})}finally{f(!1)}}};return null==e?(0,r.jsx)(l.Z,{title:"Loading...",children:(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Loading..."})})}):(0,r.jsx)(l.Z,{title:"Settings",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Account Settings"}),m&&(0,r.jsx)("div",{className:"p-3 rounded mb-6 ".concat("error"===m.type?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:m.text}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Profile Information"}),(0,r.jsxs)("form",{onSubmit:p,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",value:e.email,disabled:!0,className:"input-field bg-gray-50"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Your email cannot be changed"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"name",className:"form-label",children:"Name"}),(0,r.jsx)("input",{id:"name",type:"text",value:o,onChange:e=>c(e.target.value),className:"input-field",placeholder:"Your name"})]}),(0,r.jsx)("button",{type:"submit",className:"btn-primary",disabled:d,children:d?"Saving...":"Save Changes"})]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Data Management"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Export Your Data"}),(0,r.jsx)("p",{className:"text-gray-600 mb-3",children:"Download all your glucose records as a CSV file for backup or to share with your healthcare provider."}),(0,r.jsx)("button",{onClick:b,className:"btn-primary",disabled:x,children:x?"Exporting...":"Export All Data (CSV)"})]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2 text-red-600",children:"Danger Zone"}),(0,r.jsx)("p",{className:"text-gray-600 mb-3",children:"Permanently delete your account and all associated data. This action cannot be undone."}),(0,r.jsx)("button",{className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{window.confirm("Are you sure you want to delete your account? This action cannot be undone.")&&alert("Account deletion would be implemented here")},children:"Delete Account"})]})]})]})]})]})})}}},function(e){e.O(0,[208,50,888,774,179],function(){return e(e.s=2837)}),_N_E=e.O()}]);