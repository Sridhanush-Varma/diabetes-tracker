(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{3141:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/records/history",function(){return n(292)}])},292:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(5893),s=n(7294),a=n(1050),l=n(1491);function i(e){let t,{records:n,groupBy:a="day"}=e,[i,o]=(0,s.useState)({}),c=e=>{o(t=>({...t,[e]:!t[e]}))};switch(a){case"week":t=(0,l.NE)(n);break;case"month":t=(0,l.cS)(n);break;default:t=(0,l.ss)(n)}return 0===n.length?(0,r.jsxs)("div",{className:"text-center py-10 px-4 bg-neutral-50 rounded-lg",children:[(0,r.jsx)("svg",{className:"w-12 h-12 text-neutral-300 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,r.jsx)("p",{className:"text-neutral-500 mb-2",children:"No records found"}),(0,r.jsx)("p",{className:"text-neutral-400 text-sm",children:"Add glucose readings to see your history"})]}):(0,r.jsx)("div",{className:"space-y-6",children:Object.entries(t).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{className:"card hover:shadow-lg transition-all duration-300",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 cursor-pointer",onClick:()=>c(t),children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-neutral-800",children:t})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 mr-3",children:[n.length," record",1!==n.length?"s":""]}),(0,r.jsx)("div",{className:"p-1 rounded-full transition-colors duration-200 ".concat(i[t]?"bg-primary-100":"bg-neutral-100"),children:(0,r.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(i[t]?"transform rotate-180 text-primary-600":"text-neutral-500"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),i[t]&&(0,r.jsx)("div",{className:"border-t border-neutral-100 pt-2",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"table-minimal",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Date"}),(0,r.jsx)("th",{children:"Time of Day"}),(0,r.jsx)("th",{children:"Glucose Level"}),(0,r.jsx)("th",{children:"Food Description"})]})}),(0,r.jsx)("tbody",{children:n.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-neutral-50",children:[(0,r.jsx)("td",{children:(0,l.up)(e.date)}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:e.time_of_day})}),(0,r.jsxs)("td",{className:"font-medium",children:[e.glucose_level," mg/dL"]}),(0,r.jsx)("td",{className:"text-neutral-600 max-w-xs truncate",children:e.food_description})]},e.id))})]})})})]},t)})})}var o=n(4898),c=n(1163);function d(){let[e,t]=(0,s.useState)(void 0),n=(0,c.useRouter)(),[l,d]=(0,s.useState)([]),[u,h]=(0,s.useState)(!0),[x,m]=(0,s.useState)("day"),[f,p]=(0,s.useState)("1m");return((0,s.useEffect)(()=>{(async function(){try{let{data:{session:e}}=await o.OQ.auth.getSession();t((null==e?void 0:e.user)||null)}catch(e){console.error("Error getting session:",e),t(null)}})();let{data:{subscription:e}}=o.OQ.auth.onAuthStateChange((e,n)=>{t((null==n?void 0:n.user)||null)});return()=>{e.unsubscribe()}},[]),(0,s.useEffect)(()=>{if(null===e){n.push("/auth");return}void 0!==e&&async function(){h(!0);try{let t="",n=new Date;switch(f){case"1m":let r=new Date(n);r.setMonth(n.getMonth()-1),t=r.toISOString().split("T")[0];break;case"3m":let s=new Date(n);s.setMonth(n.getMonth()-3),t=s.toISOString().split("T")[0];break;case"6m":let a=new Date(n);a.setMonth(n.getMonth()-6),t=a.toISOString().split("T")[0];break;case"1y":let l=new Date(n);l.setFullYear(n.getFullYear()-1),t=l.toISOString().split("T")[0]}let i=o.OQ.from("glucose_records").select("*").eq("user_id",e.id);t&&(i=i.gte("date",t));let{data:c,error:u}=await i.order("date",{ascending:!1});if(u)throw u;d(c||[])}catch(e){console.error("Error fetching records:",e)}finally{h(!1)}}()},[e,n,f]),null==e)?(0,r.jsx)(a.Z,{title:"Loading...",children:(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Loading..."})})}):(0,r.jsx)(a.Z,{title:"Records History",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4 md:mb-0",children:"Your Glucose Records"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"groupBy",className:"block text-sm font-medium text-gray-700 mb-1",children:"Group By"}),(0,r.jsxs)("select",{id:"groupBy",value:x,onChange:e=>m(e.target.value),className:"input-field",children:[(0,r.jsx)("option",{value:"day",children:"Day"}),(0,r.jsx)("option",{value:"week",children:"Week"}),(0,r.jsx)("option",{value:"month",children:"Month"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"dateRange",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),(0,r.jsxs)("select",{id:"dateRange",value:f,onChange:e=>p(e.target.value),className:"input-field",children:[(0,r.jsx)("option",{value:"1m",children:"Last Month"}),(0,r.jsx)("option",{value:"3m",children:"Last 3 Months"}),(0,r.jsx)("option",{value:"6m",children:"Last 6 Months"}),(0,r.jsx)("option",{value:"1y",children:"Last Year"}),(0,r.jsx)("option",{value:"all",children:"All Time"})]})]})]})]}),u?(0,r.jsx)("div",{className:"card p-12 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Loading records..."})}):(0,r.jsx)(i,{records:l,groupBy:x})]})})}},1491:function(e,t,n){"use strict";n.d(t,{L5:function(){return m},NE:function(){return j},cS:function(){return g},p6:function(){return u},ps:function(){return x},ss:function(){return p},sy:function(){return f},up:function(){return h}});var r=n(6989),s=n(4500),a=n(8825),l=n(258),i=n(154),o=n(8078),c=n(1999),d=n(8352);function u(e){let t="string"==typeof e?new Date(e):e;return(0,r.Z)(t,"yyyy-MM-dd")}function h(e){let t="string"==typeof e?new Date(e):e;return(0,r.Z)(t,"MMMM d, yyyy")}function x(){let e=new Date;return{start:(0,s.Z)(e),end:(0,a.Z)(e)}}function m(){let e=new Date;return{start:(0,l.Z)(e),end:(0,i.Z)(e)}}function f(){let e=new Date;return{start:(0,o.Z)(e),end:(0,c.Z)(e)}}function p(e){return e.reduce((e,t)=>{let n=u(t.date);return e[n]||(e[n]=[]),e[n].push(t),e},{})}function j(e){return e.reduce((e,t)=>{let n=(0,d.Z)(t.date),r=u((0,s.Z)(n)),l=u((0,a.Z)(n)),i="".concat(r," to ").concat(l);return e[i]||(e[i]=[]),e[i].push(t),e},{})}function g(e){return e.reduce((e,t)=>{let n=(0,d.Z)(t.date),s=(0,r.Z)(n,"MMMM yyyy");return e[s]||(e[s]=[]),e[s].push(t),e},{})}}},function(e){e.O(0,[208,309,50,888,774,179],function(){return e(e.s=3141)}),_N_E=e.O()}]);